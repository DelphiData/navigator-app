name: Pull 3 Smartsheets â†’ data/

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"  # every 30 min

permissions:
  contents: write

jobs:
  pull:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Ensure data folder
        run: mkdir -p data scripts

      - name: Write puller script
        run: |
          cat > scripts/pull-smartsheet.mjs <<'EOF'
          import fs from "fs/promises";

          const {
            SMARTSHEET_ACCESS_TOKEN,
            SHEET_ORGS_ID,
            SHEET_COMMS_ID,
            SHEET_RULES_ID,
            OPENAI_API_KEY,
            ENABLE_OPENAI = "true"   // set to "false" if you want to skip keyword expansion
          } = process.env;

          if (!SMARTSHEET_ACCESS_TOKEN)
            throw new Error("Mis
